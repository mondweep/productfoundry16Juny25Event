# Live Conditions Backend API\n\nBackend API server for the Aotearoa & Aussie Live Conditions application. Provides real-time weather, ocean, and traffic data with user management, caching, and WebSocket support.\n\n## Features\n\n- ğŸŒ¦ï¸ **Weather Data**: Current conditions, forecasts, and historical data\n- ğŸŒŠ **Ocean Conditions**: Wave heights, tides, surf forecasts\n- ğŸš— **Traffic Information**: Real-time traffic, routes, incidents\n- ğŸš¨ **Smart Alerts**: Location-based notifications and warnings\n- ğŸ‘¥ **User Management**: Authentication, profiles, preferences\n- âš¡ **Real-time Updates**: WebSocket connections for live data\n- ğŸ” **Security**: JWT authentication, API key validation, rate limiting\n- ğŸš€ **Performance**: Redis caching, request optimization\n- ğŸ“Š **Monitoring**: Health checks, metrics, logging\n\n## Quick Start\n\n### Prerequisites\n\n- Node.js 18+ and npm 8+\n- MongoDB 4.4+\n- Redis (optional, for distributed caching)\n\n### Installation\n\n1. **Clone and install dependencies:**\n   ```bash\n   cd live-conditions-app/backend\n   npm install\n   ```\n\n2. **Configure environment:**\n   ```bash\n   cp .env.example .env\n   # Edit .env with your configuration\n   ```\n\n3. **Start development server:**\n   ```bash\n   npm run dev\n   ```\n\n4. **Build for production:**\n   ```bash\n   npm run build\n   npm start\n   ```\n\n## Environment Configuration\n\nKey environment variables in `.env`:\n\n```bash\n# Server\nPORT=3001\nNODE_ENV=development\n\n# Database\nMONGODB_URI=mongodb://localhost:27017/live_conditions\n\n# Authentication\nJWT_SECRET=your-super-secret-jwt-key\nJWT_REFRESH_SECRET=your-refresh-secret\n\n# External APIs\nWEATHER_API_KEY=your-openweather-api-key\nMETSERVICE_NZ_API=your-metservice-key\nBOM_AU_API=your-bom-key\n\n# WebSocket\nWS_PORT=3002\n\n# Cache (optional)\nREDIS_URL=redis://localhost:6379\n```\n\n## API Documentation\n\n### Base URL\n```\nhttp://localhost:3001/api/v1\n```\n\n### Authentication\n\nMost endpoints require either:\n- **API Key**: Include `x-api-key` header\n- **JWT Token**: Include `Authorization: Bearer <token>` header\n\n### Core Endpoints\n\n#### Weather\n```bash\n# Current weather\nGET /weather/current?latitude=-36.8485&longitude=174.7633\n\n# 7-day forecast\nGET /weather/forecast?latitude=-36.8485&longitude=174.7633&days=7\n\n# Weather alerts\nGET /weather/alerts?latitude=-36.8485&longitude=174.7633\n```\n\n#### Ocean\n```bash\n# Ocean conditions\nGET /ocean/conditions?latitude=-36.8485&longitude=174.7633\n\n# Surf forecast\nGET /ocean/surf?latitude=-36.8485&longitude=174.7633&days=3\n\n# Tide data\nGET /ocean/tides?latitude=-36.8485&longitude=174.7633&days=7\n```\n\n#### Traffic\n```bash\n# Traffic conditions\nGET /traffic/conditions?latitude=-36.8485&longitude=174.7633&radius=10\n\n# Route planning\nGET /traffic/route?origin[latitude]=-36.8485&origin[longitude]=174.7633&destination[latitude]=-37.7749&destination[longitude]=175.2033\n```\n\n#### User Management\n```bash\n# Register\nPOST /auth/register\n{\n  \"email\": \"user@example.com\",\n  \"password\": \"SecurePass123!\",\n  \"firstName\": \"John\",\n  \"lastName\": \"Doe\"\n}\n\n# Login\nPOST /auth/login\n{\n  \"email\": \"user@example.com\",\n  \"password\": \"SecurePass123!\"\n}\n\n# Get profile\nGET /auth/me\nAuthorization: Bearer <jwt-token>\n```\n\n## WebSocket Integration\n\nConnect to real-time updates:\n\n```javascript\nconst ws = new WebSocket('ws://localhost:3002');\n\n// Authenticate\nws.send(JSON.stringify({\n  type: 'authenticate',\n  data: { token: 'your-jwt-token' }\n}));\n\n// Subscribe to updates\nws.send(JSON.stringify({\n  type: 'subscribe',\n  data: { topics: ['weather', 'ocean', 'traffic', 'alerts'] }\n}));\n\n// Receive real-time updates\nws.onmessage = (event) => {\n  const message = JSON.parse(event.data);\n  console.log('Received:', message);\n};\n```\n\n## Architecture\n\n### Project Structure\n```\nsrc/\nâ”œâ”€â”€ api/           # Route handlers\nâ”‚   â”œâ”€â”€ auth.ts    # Authentication endpoints\nâ”‚   â”œâ”€â”€ weather.ts # Weather data endpoints\nâ”‚   â”œâ”€â”€ ocean.ts   # Ocean conditions endpoints\nâ”‚   â”œâ”€â”€ traffic.ts # Traffic information endpoints\nâ”‚   â”œâ”€â”€ alerts.ts  # Alert management endpoints\nâ”‚   â””â”€â”€ health.ts  # Health check endpoints\nâ”œâ”€â”€ middleware/    # Express middleware\nâ”‚   â”œâ”€â”€ auth.ts    # JWT authentication\nâ”‚   â”œâ”€â”€ apiKey.ts  # API key validation\nâ”‚   â”œâ”€â”€ rateLimiter.ts # Rate limiting\nâ”‚   â”œâ”€â”€ validation.ts  # Request validation\nâ”‚   â””â”€â”€ errorHandler.ts # Error handling\nâ”œâ”€â”€ models/        # Database models\nâ”‚   â”œâ”€â”€ User.ts    # User model\nâ”‚   â””â”€â”€ Alert.ts   # Alert model\nâ”œâ”€â”€ services/      # Business logic\nâ”‚   â”œâ”€â”€ weather.ts # Weather service integration\nâ”‚   â”œâ”€â”€ cache.ts   # Caching service\nâ”‚   â””â”€â”€ websocket.ts # WebSocket management\nâ”œâ”€â”€ utils/         # Utilities\nâ”‚   â””â”€â”€ logger.ts  # Logging configuration\nâ”œâ”€â”€ config/        # Configuration\nâ”‚   â”œâ”€â”€ database.ts # Database connection\nâ”‚   â””â”€â”€ constants.ts # Application constants\nâ””â”€â”€ server.ts      # Express server setup\n```\n\n### Key Components\n\n1. **Authentication System**\n   - JWT-based authentication\n   - Refresh token support\n   - Role-based access control\n   - API key validation\n\n2. **Data Integration**\n   - Multiple weather APIs (MetService NZ, BOM AU, OpenWeatherMap)\n   - Ocean condition services\n   - Traffic data providers\n   - Smart provider selection by location\n\n3. **Caching Strategy**\n   - Multi-tier caching (memory + Redis)\n   - Different TTL by data type\n   - Cache invalidation strategies\n\n4. **Real-time Features**\n   - WebSocket connections\n   - Live data broadcasting\n   - User-specific notifications\n\n5. **Security & Performance**\n   - Rate limiting with Redis\n   - Request validation\n   - Error handling\n   - Health monitoring\n\n## Scripts\n\n```bash\n# Development\nnpm run dev          # Start development server with hot reload\nnpm run type-check   # TypeScript type checking\n\n# Building\nnpm run build        # Build for production\nnpm start           # Start production server\n\n# Testing\nnpm test            # Run tests\nnpm run test:watch  # Run tests in watch mode\n\n# Code Quality\nnpm run lint        # ESLint\nnpm run lint:fix    # ESLint with auto-fix\n```\n\n## Deployment\n\n### Docker\n\n```bash\n# Build image\ndocker build -t live-conditions-backend .\n\n# Run container\ndocker run -p 3001:3001 -p 3002:3002 live-conditions-backend\n```\n\n### Production Checklist\n\n- [ ] Set `NODE_ENV=production`\n- [ ] Configure MongoDB replica set\n- [ ] Setup Redis cluster (if using)\n- [ ] Configure external API keys\n- [ ] Setup SSL/TLS certificates\n- [ ] Configure load balancer\n- [ ] Setup monitoring and logging\n- [ ] Configure backup strategies\n\n## Health Monitoring\n\n### Health Check Endpoints\n\n```bash\n# Basic health\nGET /health\n\n# Detailed health with service status\nGET /health/detailed\n\n# Kubernetes readiness\nGET /health/ready\n\n# Kubernetes liveness\nGET /health/live\n```\n\n### Metrics\n\n```bash\n# Application metrics\nGET /health/metrics\n\n# WebSocket statistics\nGET /health/websocket\n\n# Cache statistics\nGET /health/cache\n```\n\n## API Keys\n\n### Creating API Keys\n\n```javascript\n// Admin endpoint to create API keys\nPOST /admin/api-keys\n{\n  \"name\": \"Frontend Application\",\n  \"permissions\": [\"weather:read\", \"ocean:read\", \"traffic:read\"],\n  \"rateLimit\": {\n    \"requests\": 10000,\n    \"window\": 3600\n  }\n}\n```\n\n### Available Permissions\n\n- `weather:read` - Weather data access\n- `ocean:read` - Ocean conditions access\n- `traffic:read` - Traffic data access\n- `alerts:read` - Alert data access\n- `alerts:write` - Alert management\n- `user:read` - User data access\n- `*` - All permissions (admin)\n\n## Contributing\n\n1. Fork the repository\n2. Create a feature branch: `git checkout -b feature/amazing-feature`\n3. Commit changes: `git commit -m 'Add amazing feature'`\n4. Push to branch: `git push origin feature/amazing-feature`\n5. Open a Pull Request\n\n## License\n\nThis project is licensed under the MIT License.\n\n## Support\n\nFor issues and questions:\n- Create an issue in the repository\n- Check the API documentation\n- Review the health check endpoints for debugging"